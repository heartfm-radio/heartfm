<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HEART FM</title>

<style>
body {
  margin: 0;
  background: #000;
  color: #ff0000;
  font-family: monospace;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.wrapper {
  width: 95%;
  max-width: 600px;
  text-align: center;
}

.header {
  font-size: 28px;
  letter-spacing: 4px;
  margin-bottom: 20px;
}

.line {
  color: #880000;
  margin: 10px 0;
  word-break: break-all;
}

.player-box {
  border: 2px dashed #ff0000;
  padding: 20px;
}

button {
  background: black;
  color: #ff0000;
  border: 2px solid #ff0000;
  padding: 12px 30px;
  font-family: monospace;
  font-size: 16px;
  cursor: pointer;
}

button:active {
  background: #ff0000;
  color: black;
}

.track {
  margin-top: 15px;
  font-size: 14px;
  min-height: 20px;
  color: #ff4444;
}

.status {
  margin-top: 8px;
  font-size: 12px;
  color: #aa0000;
}

@media (max-width: 480px) {
  .header {
    font-size: 20px;
  }

  button {
    width: 100%;
  }
}
</style>
</head>

<body>

<div class="wrapper">

  <div class="header">
    ----- HEART FM -----
  </div>

  <div class="line">
    ------------------------------------------------------------
  </div>

  <div class="player-box">

    <button id="playBtn">▶ ПУСК</button>

    <div class="track" id="trackName">
      -- ожидание сигнала --
    </div>

    <div class="status" id="statusLine"></div>

  </div>

  <div class="line">
    ------------------------------------------------------------
  </div>

</div>

<audio id="radio" preload="none">
  <source src="https://icecast.gtrk22.ru:8443/heartfm" type="audio/mpeg">
</audio>

<script>
const аудио = document.getElementById("radio");
const кнопка = document.getElementById("playBtn");
const названиеТрека = document.getElementById("trackName");
const строкаСтатуса = document.getElementById("statusLine");

let играет = false;

/* ПУСК / СТОП */
кнопка.addEventListener("click", async () => {

  if (!играет) {
    try {
      await аудио.play();
      кнопка.textContent = "■ СТОП";
      строкаСтатуса.textContent = "-- В ЭФИРЕ --";
      играет = true;
    } catch (ошибка) {
      строкаСтатуса.textContent = "-- воспроизведение заблокировано --";
    }

  } else {
    аудио.pause();
    кнопка.textContent = "▶ ПУСК";
    строкаСтатуса.textContent = "-- остановлено --";
    играет = false;
  }

});

/* Автопереподключение если поток оборвался */
аудио.addEventListener("error", () => {
  строкаСтатуса.textContent = "-- переподключение... --";

  setTimeout(() => {
    if (играет) {
      аудио.load();
      аудио.play();
    }
  }, 3000);
});

/* Получение текущего трека */
async function получитьТрек() {
  try {
    const ответ = await fetch("https://icecast.gtrk22.ru:8443/status-json.xsl");
    const данные = await ответ.json();

    let источник = данные.icestats.source;

    if (Array.isArray(источник)) {
      источник = источник.find(s => s.listenurl.includes("heartfm"));
    }

    if (источник && источник.title) {
      названиеТрека.textContent = "> " + источник.title;
    } else {
      названиеТрека.textContent = "-- нет данных о треке --";
    }

  } catch (ошибка) {
    названиеТрека.textContent = "-- сигнал потерян --";
  }
}

setInterval(получитьТрек, 10000);
получитьТрек();
</script>

</body>
</html>
